angular.module("app",["ngRoute","ui.bootstrap"]);function config(e,r){e.when("/",{templateUrl:"/startPage/start.html"}).when("/record/:recordid",{templateUrl:"/recordDetail/recordDetail.view.html",controller:"recordCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/home",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});r.html5Mode(true)}angular.module("app").config(["$routeProvider","$locationProvider",config]);(function(){angular.module("app").controller("modalCtrl",e);e.$inject=["$scope","$uibModalInstance","todoData","authentication"];function e(e,r,o,t){e.formError="";e.currentUser=t.currentUser();e.onSubmit=function(){if(e.formData.title.length>17){e.formError="more than 17 characters";return false}else{e.formData.email=e.currentUser.email;o.recordCreate(e.formData).success(function(r){e.close(r)}).error(function(r){e.formError="Please try again"});return false}};e.close=function(e){r.close(e)};e.cancel=function(){r.dismiss("cancel")}}})();(function(){e.$inject=["$scope","$uibModalInstance","$routeParams","todoData","recordData"];function e(e,r,o,t,n){e.recordData=n;e.onUpdate=function(){if(e.recordData.title.length>17){e.formError="more than 17 characters";return false}else{t.updateOne(e.recordData.recordid,e.recordData).success(function(r){e.close(r)}).error(function(r){e.formError="Please try again"});return false}};e.close=function(e){r.close(e)};e.cancel=function(){r.dismiss("cancel")}}angular.module("app").controller("updateCtrl",e)})();(function(){angular.module("app").controller("recordCtrl",e);e.$inject=["$scope","$routeParams","todoData"];function e(e,r,o){var t=this;t.recordid=r.recordid;t.pageHeader={title:t.recordid};o.readOne(t.recordid).success(function(e){t.data={record:e};t.pageHeader={title:t.data.record.title,description:t.data.record.description}}).error(function(e){console.log(e)})}})();(function(){angular.module("app").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var o=this;o.credentials={name:"",email:"",password:""};o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";r.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.path("/home")})}}})();(function(){angular.module("app").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var o=this;o.credentials={email:"",password:""};o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";r.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.path("/home")})}}})();angular.module("app").directive("footerGeneric",footerGeneric);function footerGeneric(){return{restrict:"EA",templateUrl:"common/directives/footerDirective/footerDirective.html"}}angular.module("app").directive("pageHeader",pageHeader);function pageHeader(){return{restrict:"EA",templateUrl:"common/directives/pageHeader/pageHeader.html"}}(function(){e.$inject=["$location","$uibModal","todoData","authentication"];function e(e,r,o,t){var n=this;n.currentUser=t.currentUser();o.recordAll(n.currentUser).success(function(e){n.data={records:e};if(n.data.records[0]){n.on=false}else{n.on=true}}).error(function(e){n.formError="No records"});n.createTask=function(){var e=r.open({templateUrl:"/modalForm/modalForm.view.html",controller:"modalCtrl"});e.result.then(function(e){n.data.records.push(e);n.on=false})};n.correctTask=function(e,t,a){var i=r.open({templateUrl:"/updateModalForm/updateModalForm.html",controller:"updateCtrl",resolve:{recordData:function(){return{recordid:e,title:t,description:a}}}});i.result.then(function(e){o.recordAll(n.currentUser).success(function(e){n.data={records:e};if(n.data.records[0]){n.on=false}else{n.on=true}}).error(function(e){n.message="There is no records"})})};n.deleteTask=function(e){o.deleteOne(e).success(function(e){console.log(e);o.recordAll(n.currentUser).success(function(e){n.data={records:e};if(n.data.records[0]){n.on=false}else{n.on=true}}).error(function(e){n.message="There is no records"})}).error(function(e){console.log(e)})};n.logout=function(){t.logout();e.path("/")}}angular.module("app").controller("homeCtrl",e)})();(function(){angular.module("app").service("todoData",e);e.$inject=["$http","authentication"];function e(e,r){var o=function(o){return e.post("api/record",o,{headers:{Authorization:"Bearer "+r.getToken()}})};var t=function(r){return e.post("api/records",r)};var n=function(o){return e.get("api/record/"+o,{headers:{Authorization:"Bearer "+r.getToken()}})};var a=function(o,t){return e.put("api/record/"+o,t,{headers:{Authorization:"Bearer "+r.getToken()}})};var i=function(o){return e.delete("api/record/"+o,{headers:{Authorization:"Bearer "+r.getToken()}})};return{recordCreate:o,recordAll:t,readOne:n,updateOne:a,deleteOne:i}}})();(function(){angular.module("app").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var o=function(e){r.localStorage["todo-Token"]=e};var t=function(){return r.localStorage["todo-Token"]};register=function(r){return e.post("api/register",r).success(function(e){o(e.token)})};login=function(r){return e.post("api/login",r).success(function(e){o(e.token)})};logout=function(){r.localStorage.removeItem("todo-Token")};var n=function(){var e=t();if(e){var o=JSON.parse(r.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var a=function(){if(n()){var e=t();var o=JSON.parse(r.atob(e.split(".")[1]));return{email:o.email,name:o.name}}};return{saveToken:o,getToken:t,register:register,login:login,logout:logout,currentUser:a,isLoggedIn:n}}})();